{"version":3,"sources":["js/es6/turkishdictionary.js"],"names":[],"mappings":";;;;;;;;;;;AAIA,IAAI,UAAU,GAAG,OAAO,CAAC,sBAAsB,CAAC,CAAC;;IAE3C,iBAAiB;AACV,WADP,iBAAiB,GACP;AACb,QAAI,CAAC,IAAI,GAAG,4CAA4C,CAAC;AACzD,QAAI,CAAC,IAAI,GAAG,EAAE,CAAC;AACd,QAAI,CAAC,QAAQ,GAAG,MAAM,CAAA;AACtB,QAAI,CAAC,KAAK,GAAG,KAAK,CAAA;AAClB,QAAI,CAAC,WAAW,GAAG,wBAAwB,CAAC;AAC5C,QAAI,CAAC,YAAY,GAAG,IAAI,CAAC;GAC1B;;uBARG,iBAAiB;AAUrB,UAAM;aAAC,gBAAC,IAAI,EAAE;AACZ,YAAI,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACpC,YAAI,CAAC,YAAY,GAAG,KAAK,CAAC;AAC1B,eAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;OAC3B;;;;;AAED,aAAS;aAAA,mBAAC,IAAI,EAAE;AACd,eAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;AACnC,YAAI,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;AAC5C,YAAI,CAAC,YAAY,GAAG,IAAI,CAAC;AACzB,YAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;OACpB;;;;;AAED,WAAO;aAAC,iBAAC,IAAI,EAAE;AACb,eAAO,CAAC,yCAAyC,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;OACnE;;;;;AAMD,WAAO;;;;;;aAAC,iBAAC,IAAI,EAAE;AACb,eAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;AAC7B,YAAI,CAAC,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;AAChC,YAAI,CAAC,GAAG,CAAC,kBAAkB,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACvE,YAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;AACrC,YAAI,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;OACjB;;;;;AAED,sBAAkB;aAAC,4BAAC,IAAI,EAAE,CAAC,EAAE;AACzB,YAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;AACnB,YAAI,GAAG,CAAC,UAAU,GAAG,CAAC,EAAE;AACtB,iBAAO;SACR,MACI,IAAI,GAAG,CAAC,MAAM,IAAI,GAAG,EAAE;AAC1B,cAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;AACvB,iBAAO,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;SACnC,MAAM,IAAI,GAAG,CAAC,UAAU,IAAI,CAAC,EAAE;AAC9B,cAAI,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AACzD,iBAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,WAAW,CAAC,CAAC;AACtD,iBAAO,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;AAClC,iBAAO,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;SAClD;OACJ;;;;;AAED,kBAAc;aAAC,wBAAC,QAAQ,EAAE;AACxB,YAAI,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;AAChC,YAAI,IAAI,CAAC,YAAY,EAAE;AACrB,gBAAM,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;SACzE;AACD,eAAO,IAAI,CAAC;OACb;;;;;AAGD,sBAAkB;;;aAAC,4BAAC,WAAW,EAAE,GAAG,EAAE;AACpC,eAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;AACnC,cAAM,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE,EAAE;AAC9B,gBAAM,EAAE,cAAc;AACtB,cAAI,EAAE,WAAW,CAAC,SAAS;AAC3B,iBAAO,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC;SAC1D,CAAC,CAAC;OACJ;;;;;AAED,gBAAY;aAAC,sBAAC,QAAQ,EAAE;AACtB,eAAO,CAAC,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;OACrC;;;;;AAGD,SAAK;;;aAAC,eAAC,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE;AAClC,YAAI,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC;YACjC,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;AACtC,YAAI,QAAQ,EAAE;AACZ,mBAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,sBAAsB,CAAC,CAAC;AAC3D,cAAI,SAAS,EAAE;AACb,qBAAS,CAAC,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC;AACvC,qBAAS,CAAC,YAAY,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;;;WAG5C,MAAM,IAAI,CAAC,MAAM,EAAE;AAClB,qBAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAA;AACzC,qBAAS,CAAC,SAAS,GAAG,eAAe,CAAC;AACtC,qBAAS,CAAC,SAAS,GAAG,oCAAoC,CAAC;WAC5D;SACF;AACD,eAAO,SAAS,CAAC;OAClB;;;;;AAID,gBAAY;;;;aAAC,sBAAC,IAAI,EAAE;AAClB,YAAI,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AACxC,WAAG,CAAC,SAAS,GAAG,IAAI,CAAC;AACrB,YAAI,OAAO,GAAG,GAAG,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC;AACjD,YAAI,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC;AACvB,eAAO,CAAC,EAAE,EACR,OAAO,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AAChD,eAAO,GAAG,CAAC,SAAS,CAAC;OACtB;;;;;AAMD,gBAAY;;;;;;aAAC,sBAAC,IAAI,EAAE;AAClB,YAAI,QAAQ;YACR,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AACxC,WAAG,CAAC,SAAS,GAAG,IAAI,CAAC;AACrB,gBAAQ,GAAG,QAAQ,CAAC,sBAAsB,EAAE,CAAC;AAC7C,eAAQ,GAAG,CAAC,UAAU,EAAG;AACvB,kBAAQ,CAAC,WAAW,CAAE,GAAG,CAAC,UAAU,CAAE,CAAC;SACxC;AACD,eAAO,QAAQ,CAAC;OACjB;;;;;;;SA1HG,iBAAiB;;;;AA8HvB,MAAM,CAAC,OAAO,GAAG,IAAI,iBAAiB,EAAE,CAAC","file":"js/es6/turkishdictionary.js","sourcesContent":["/*\n  Translation engine: http://www.turkishdictionary.net\n  For translating turkish-russian and vice versa\n*/\nvar CHAR_CODES = require('./char-codes-turk.js');\n\nclass TurkishDictionary {\n  constructor() {\n  \tthis.host = 'http://www.turkishdictionary.net/?word=%FC';\n  \tthis.path = '';\n    this.protocol = 'http'\n    this.query = '&s='\n    this.TABLE_CLASS = '___mtt_translate_table';\n    this.need_publish = true;\n  }\n\n  search (data) {\n    data.url = this.makeUrl(data.value);\n    this.need_publish = false;\n    return this.request(data);\n  }\n\n  translate(data) {\n    console.log('request data:', data);\n    data.url = this.makeUrl(data.selectionText);\n    this.need_publish = true;\n    this.request(data);\n  }\n\n  makeUrl (text) {\n    return ['http://www.turkishdictionary.net/?word=', text].join('');\n  }\n\n  /*\n    Request translation and run callback function\n    passing translated result or error to callback\n  */\n  request (opts) {\n    console.log('start request');\n    this.xhr = new XMLHttpRequest();\n    this.xhr.onreadystatechange = this.onReadyStateChange.bind(this, opts);\n    this.xhr.open(\"GET\", opts.url, true);\n    this.xhr.send();\n  }\n\n  onReadyStateChange (opts, e) {\n      let xhr = this.xhr;\n      if (xhr.readyState < 4) {\n        return;\n      }\n      else if (xhr.status != 200) {\n        this.errorHandler(xhr);\n        return opts.error && opts.error();\n      } else if (xhr.readyState == 4) {\n        let translation = this.successHandler(e.target.response);\n        console.log('success turkish translate', translation);\n        console.log('call', opts.success);\n        return opts.success && opts.success(translation);\n      }\n  }\n\n  successHandler (response) {\n    var data = this.parse(response);\n    if (this.need_publish) {\n      chrome.tabs.getSelected(null, this.publishTranslation.bind(this, data));\n    }\n    return data;\n  }\n\n  /* publish successfuly translated text all over extension */\n  publishTranslation (translation, tab) {\n    console.log('publish translation');\n    chrome.tabs.sendMessage(tab.id, {\n      action: 'open_tooltip',\n      data: translation.outerHTML,\n      success: !translation.classList.contains('failTranslate')\n    });\n  }\n\n  errorHandler (response) {\n    console.log('error ajax', response);\n  }\n\n  /* Parse response from translation engine */\n  parse (response, silent, translate) {\n    var doc = this.stripScripts(response),\n        fragment = this.makeFragment(doc);\n    if (fragment) {\n      translate = fragment.querySelector('#meaning_div > table');\n      if (translate) {\n        translate.className = this.TABLE_CLASS;\n        translate.setAttribute(\"cellpadding\", \"5\");\n        // @fixImages(translate)\n        // @fixLinks(translate)\n      } else if (!silent) {\n        translate = document.createElement('div')\n        translate.className = 'failTranslate';\n        translate.innerText = \"Unfortunately, could not translate\";\n      }\n    }\n    return translate;\n  }\n\n  //TODO extract to base engine class\n  /* removes <script> tags from html code */\n  stripScripts (html) {\n    var div = document.createElement('div');\n    div.innerHTML = html;\n    var scripts = div.getElementsByTagName('script');\n    let i = scripts.length;\n    while (i--)\n      scripts[i].parentNode.removeChild(scripts[i]);\n    return div.innerHTML;\n  }\n\n  //TODO extract to base engine class\n  /* creates temp object to parse translation from page \n    (since it's not a friendly api) \n  */\n  makeFragment (html) {\n    var fragment,\n        div = document.createElement(\"div\");\n    div.innerHTML = html;\n    fragment = document.createDocumentFragment();\n    while ( div.firstChild ) {\n      fragment.appendChild( div.firstChild );\n    }\n    return fragment;\n  }\n}\n\n// Singletone\nmodule.exports = new TurkishDictionary();"]}