{"version":3,"sources":["js/es6/options.js"],"names":[],"mappings":"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","file":"js/es6/options.js","sourcesContent":["var _ = require('../utils.js');\n//var SERVICE_URL = 'http://tran-service.com/user/';\nvar SERVICE_URL = 'http://localhost:5000/api/user/';\n\nclass Options {\n  constructor () {\n    this.signed = document.getElementById('signed');\n    this.needSign = document.getElementById('need-sign');\n  }\n\n  /** Restores select box and checkbox state using\n   * the preferences stored in chrome.storage.*/\n  restore () {\n    // Use default value language is 'english' and fast translate is true\n    var defaults = {\n      language: '1',\n      fast: true,\n      memorize: false\n    }\n    this.storage('get', defaults, this.onRestore);\n  }\n\n  /** Saves options to chrome.storage */\n  save (params={restored:false}) {\n    // save options if only it is not restored onload\n    if (!params.restored) {\n      this.storage('set', this.options, this.onSave)\n    }\n  }\n\n  onSave () {\n    // let user know that options are saved.\n    var status = document.getElementById('status')\n    status.textContent = 'Options saved.'\n    let hideStatus = function () { status.textContent = ''}\n    setTimeout(hideStatus, 750);\n  }\n\n  /** Handler of success options restore */\n  onRestore (items) {\n      // set checkboxes\n      this.options = items;\n      this.save({restored:true})\n  }\n\n  /** chrome storage wrapper */\n  storage (op, data, cb) {\n    cb = cb.bind(this)\n    if (op == 'set') {\n      chrome.storage.sync.set(data, evt => cb(evt));\n    } else if (op == 'get') {\n      chrome.storage.sync.get(data, evt => cb(evt));\n    }\n  }\n\n  /** toggle memorize option */\n  memorize () {\n    if (this.options.memorize) {\n      this.check_auth().then(\n        res => this.authorized = true,\n        res => this.authorized = false\n    )\n    } else {\n      this.signed.classList.add('hidden');\n      this.needSign.classList.add('hidden');\n    }\n  }\n\n  check_login () {\n    _.get(SERVICE_URL).then(\n      res => this.memok(res),\n      res => this.memfail(res)\n    );\n  }\n\n  /** memorization is activated */\n  memok (response) {\n    this.authorized = true;\n  }\n\n  /** memorization failed */\n  memfail (response) {\n      this.authorized = false;\n  }\n\n  get options () {\n    return {\n        language: document.getElementById('language').value,\n        fast: document.getElementById('fast').checked,\n        memorize: document.getElementById('memorize').checked\n    }\n  }\n\n  set options (values={}) {\n      document.getElementById('language').value = values.language;\n      document.getElementById('fast').checked = values.fast;\n      document.getElementById('memorize').checked = values.memorize;\n  }\n\n  set authorized (state=false) {\n    if (state) {\n      this.signed.classList.remove('hidden');\n      this.needSign.classList.add('hidden');\n    } else {\n      this.needSign.classList.remove('hidden');\n      this.signed.classList.add('hidden');\n    }\n  }\n\n  check_auth () {\n    return new Promise(function(resolve, reject) {\n      this.storage('get', 'auth_token', function (data) {\n        if (!data.auth_token) {\n          reject();\n        } else {\n          _.get(SERVICE_URL, {headers:{'X-AUTH-TOKEN': data.auth_token}}).then(\n            res => resolve(res),\n            res => reject(res)\n          )\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n\n  signin () {\n    var cred = {\n      login: document.getElementById('login').value,\n      password: document.getElementById('password').value\n    }\n\n    _.post(SERVICE_URL, {data:cred}).then(\n      res => this.authSuccess(res),\n      res => this.authFail(res)\n    )\n  }\n\n  authSuccess(data) {\n    this.storage('set', {'auth_token': data}, data => function (data) {});\n    this.authorized = true;\n  }\n\n  authFail (data) {\n    console.log('fail auth', data);\n    var status = document.querySelector('.error-login')\n    status.textContent = 'Bad login or password.'\n    let hideStatus = function () { status.textContent = ''}\n    setTimeout(hideStatus, 2750);\n  }\n\n  revoke (event) {\n    event.preventDefault();\n    this.storage('set', {'auth_token': null}, function (data) {\n      this.authorized = false;\n    }.bind(this));\n  }\n}\n\nvar options = new Options();\n\ndocument.addEventListener('DOMContentLoaded', evt=> options.restore());\ndocument.getElementById('save').addEventListener('click', evt=> options.save());\ndocument.getElementById('memorize').addEventListener('click', evt=> options.memorize());\ndocument.getElementById('signinBtn').addEventListener('click', evt=> options.signin());\ndocument.querySelector('#revoke').addEventListener('click', evt=> options.revoke(evt))"]}