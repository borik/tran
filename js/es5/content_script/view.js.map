{"version":3,"sources":["js/es6/content_script/view.js"],"names":[],"mappings":"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","file":"js/es6/content_script/view.js","sourcesContent":["var Tooltip = require('./tooltip.js')\nvar TEXTBOX_TAGS = ['input', 'textarea']\n\nclass Main {\n  constructor () {\n    window.addEventListener('mousedown', e => this.mouseDownEvent(e))\n    document.addEventListener('mousedown', e => this.mouseDownEvent(e))\n    window.addEventListener('mouseup', e => this.mouseUpEvent(e))\n    document.addEventListener('contextmenu', e => this.saveMousePosition(e))\n    this.coordinates = { mouseX: 0, mouseY: 0 };\n\n    this.tooltip = new Tooltip(this.coordinates);\n\n    chrome.runtime.onMessage.addListener(function (msg) {\n      if (msg.action == 'open_tooltip' || msg.action == 'similar_words') {\n        //don't show annoying tooltip when typing\n        if (!msg.success && this.tooltip.clickTarget == 'textbox') {\n          return\n        } else if (msg.action == 'similar_words') {\n          this.tooltip.render(msg.data, this.attachSimilarWordsHandlers);\n        } else {\n          this.tooltip.render(msg.data)\n        }\n      }\n    });\n  }\n\n  requestSearch (selection) {\n    chrome.runtime.sendMessage({\n      method: \"request_search\",\n      data: {\n        selectionText: selection\n      }\n    })\n  }\n\n  saveMousePosition (e) {\n    this.coordinates.mouseX = e.pageX + 5\n    this.coordinates.mouseY = e.pageY + 10\n    this.tooltip.setCoordinates(this.coordinates);\n  }\n\n  mouseDownEvent (e) {\n    var tag = e.target.tagName.toLowerCase();\n    if (TEXTBOX_TAGS.indexOf(tag) != -1) {\n      this.tooltip.clickTarget = 'textbox';\n    }\n  }\n\n  mouseUpEvent (e) {\n    // fix for accidental tooltip appearance when clicked on text\n    handler = function () {\n      this.saveMousePosition(e);\n      selection = this.getSelection()\n      if (selection.length > 0) {\n        chrome.storage.sync.get({fast: true}, function (items) {\n          if (items.fast) {\n            this.requestSearch(selection);\n          }\n        });\n      }\n    }\n    setTimeout(handler, 10);\n    return true;\n  }\n\n  getSelection (e) {\n      var txt = window.getSelection().toString();\n      var span = document.createElement('SPAN')\n      span.innerHTML = txt;\n      var selection = span.textContent.trim();\n      return selection\n  }\n\n  attachSimilarWordsHandlers (fragment) {\n    for (let link of fragment.querySelectorAll('a')) {\n      // sanitize\n      link.removeAttribute('onclick');\n      link.onclick = null;\n      let clone = link.cloneNode(true);\n      link.parentNode.replaceChild(clone, link);\n      let word = clone.textContent;\n      // Prevent link from being followed.\n      clone.addEventListener('click', function (e) {\n        e.stopPropagation(); e.preventDefault();\n      });\n      // Don't let @mouseUpEvent fire again with the wrong word.\n      self = this;\n      clone.addEventListener('mouseup', function (e) {\n        e.stopPropagation()\n        self.requestSearch(word);\n      })\n    }\n    return true;\n  }\n}\nmodule.exports = Main\n"]}